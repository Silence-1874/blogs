> 这一篇主要是为了阅读`HashMap`和`TreeMap`的源码而准备的，主要是介绍原理，不涉及代码实现。

# 从2-3树说起
2-3树就是一种**3阶B树**，由**2-结点**或**3-结点**组成，其中2-结点有**一个键**与**两个链接**，3-结点有**两个键**与**三个链接**。

## 查找
按照一般的查找树进行查找。

## 插入
### 只含有一个2-结点
![](https://s2.loli.net/2022/07/28/NYC1LKFVj5g76ye.png)

### 只含有一个3-结点
![](https://s2.loli.net/2022/07/28/Ie3vgirKXJGLOMW.png)

### 父结点为2-结点的3-结点
![](https://s2.loli.net/2022/07/28/qMGbheC5DuWnQSm.png)

### 父结点为3-结点的3-结点
![](https://s2.loli.net/2022/07/28/hb3geJCUm49oNp7.png)

## 删除
### 底部的3-结点
![](https://s2.loli.net/2022/07/28/6jx9pXHiMBfJLV7.png)

### 底部的2-结点
#### 父结点的右孩子为3-结点
![](https://s2.loli.net/2022/07/28/mSJ1at5QkGEbd4f.png)

#### 父结点与父结点的右孩子均为2-结点
![](https://s2.loli.net/2022/07/29/jX8CfPb4TFE5IlY.png)

#### 父结点为3-结点
![](https://s2.loli.net/2022/07/29/1hBQNurSIROmYeC.png)

#### 满二叉树
![](https://s2.loli.net/2022/07/29/CVoxDw1PeaJy2Yz.png)

#### 中间结点
只需要用前驱（小于该结点的最大结点）或后继（大于该结点的最小结点）与该结点交换，这样就转换成了上面的几种情况。

## 总结
- 4-结点的分解是**局部变换**，不会影响树的有序性和平衡性。

- 2-3树是**自底向上**生长的。

2-3树需要维护两种结点，开销较大，下面引入红黑树。

# 左倾红黑树
在普通的**二叉查找树**上引入**颜色**属性来代表**2-3树**中的不同结点。

**红链接**为将两个2-结点链接起来构成一个3-结点，**黑链接**是2-3树中的普通链接。

- 每个结点要么是**红色**，要么是**黑色**

- 根结点一定是**黑色**

- 所有叶子节点（**空结点**）是**黑色**（下面就不画出黑色的空结点了）

- 任何两个红结点之间不能**直接相连**

- 红黑树是**完美黑色平衡**的，即任意结点到叶子结点的路径上**黑结点**数量相同
 
- 红黑树整体并非完美平衡，最长路径不会超过最短路径的**两倍**

- ***（左倾红黑树特有性质）*** 规定红链接均为**左链接**，即**红结点**一定是**左孩子**，因此称为**左倾红黑树**

由2-3树转化为红黑树如下图：

![](https://s2.loli.net/2022/07/28/Ufa3L1gYxGFBesR.png)

由于树中每个结点只会有一条指向它的链接，将**结点的颜色**定义为**指向它的链接的颜色**（因此空结点都为黑色），如下图：

![](https://s2.loli.net/2022/07/28/pxXqbOBSfewIhjr.png)

## 旋转
在维护左倾红黑树的过程中，可能会出现红色右链接或两条连续的红链接，需要使用**旋转**操作进行调整，如下图：

![](https://s2.loli.net/2022/07/28/CnFfkxDAM2pSt8q.png)

## 插入
插入的结点总是在**叶子结点**上，且都看作**红结点**。

### 2-结点
![](https://s2.loli.net/2022/07/28/OHpr1MDGhXjoNcA.png)

### 3-结点
![](https://s2.loli.net/2022/07/28/cWCG7mTHSP81LRq.png)

分解4-结点时，为了保持**完美黑色平衡**，需要将红链接向上传递，如下图：

![](https://s2.loli.net/2022/07/28/ypUCdNf698kGL3g.png)

如果最后已经是根结点，根据性质，不需要将其变成红色了。

## 删除
比较复杂，不过跟2-3树一一对应就好，情况较多，暂时先放一会儿。

# 参考资料
[《算法》(第四版)](https://book.douban.com/subject/19952400/)
[红黑树——硕硕的博客](https://sakurawood.github.io/2017/06/25/%E7%BA%A2%E9%BB%91%E6%A0%91/)
[[CSDN]2-3树的插入和删除](https://blog.csdn.net/qq_40327837/article/details/85855403)
[[CSDN]2-3树的删除](https://blog.csdn.net/mengzhisuoliu/article/details/44752215)