> 若无特殊声明，博客中的Spring源码版本为 5.2.12.RELEASE

# 理论
**Inversion of Control, IoC**，即**控制反转**，是一种设计思想。

> 什么是“控制”？

在传统的开发中，程序通过`new`关键字主动创建对象，并处理依赖，控制的就是**对象的创建**。

> 什么是“反转”？

使用 Spring 后，对象的创建就交给了 **IoC容器**，由容器来控制对象的创建，程序不需要关心对象是怎么创建的，什么时候创建的，只需要直接**从容器中**获取使用。


## 依赖注入
**Dependency Injection, DI**，即**依赖注入**，是控制反转的一种**实现方式**。

**程序**依赖 **IoC 容器**注入其所需要的**外部资源**（对象、文件等）。

## 优点
- 降低了对象之间的**耦合度**。**面向接口编程**时，不需要考虑注入哪一种具体实现，容器会自动注入合适的接口实现。

- 更容易管理资源。`Spring`已经提供了单例的实现，不需要自己手写。

# BeanFactory 接口
最顶层接口，提供了 IoC 容器最基本的功能。

## 常用方法
### Object getBean(String)
根据指定名称返回一个 Bean，客户端需要自己进行类型转换。

### Object getBean(String name, Object... args)
根据指定名称和参数返回一个 Bean，客户端需要自己进行类型转换。

### T getBean(String name, Class<T> requiredType) 
根据指定名称和类型返回一个 Bean，客户端不需要自己进行类型转换，若类型转换失败，容器抛出异常。

### T getBean(Class<T> requiredType)
根据指定类型返回一个 Bean，客户端不需要自己进行类型转换，若类型转换失败/找不到对应类型/对应类型的 Bean 不唯一，容器抛出异常。

### T getBean(Class<T> requiredType, Object... args)
根据指定类型和参数返回一个 Bean，客户端不需要自己进行类型转换，若类型转换失败/找不到对应类型/对应类型的 Bean 不唯一，容器抛出异常。

### boolean containsBean(String name);
根据指定名称查找容器中的`BeanDefinition`或**外部注册单例**。

## 常见实现类  
`XmlBeanFactory` 从**类加载路径**或**文件系统**获得 **XML** 配置文件

`DefaultListableBeanFactory` 默认使用的实现类

# ApplicationContext 接口
![](https://s2.loli.net/2022/08/13/GHghsmnpiQA37JV.png)

间接继承了`BeanFactory`接口，提供了更多的功能。

- `EnvironmentCapable` 提供获得**配置信息**或**环境变量**的支持

- `ApplicationEventPublisher` 提供**时间发布**的支持

- `ResourcePatternResolver` 提供**根据通配符寻找资源**的支持

- `MessageSource` 提供**国际化**支持

## 常见实现类
`ClassPathXmlApplicationContext` 从 **类加载路径** 获得配置文件

`FileSystemXmlApplicationContext` 从 **文件系统** 获得配置文件

`AnnotationConfigApplicationContext` 根据**配置类**与**注解**实现配置

`AnnotationConfigServletWebServerApplicationContext` 根据**配置类**与**注解**实现配置，用于 Web 环境

# BeanDefinition 接口
Bean 在容器中的表现形式，用来描述一个 Bean。

这个接口里提供了一系列 get/set 方法，但本身不含有相关属性，这些属性定义在`AbstractBeanDefinition`抽象类中。

## 常用属性
### beanClassName
该类的名称，不一定为真实类名，具体含义由子类决定。

### scope
作用域（单例、多例等）。

### lazyInit
是否懒加载。

### autowireCandidate
是否作为自动注入其他 Bean 的候选者。

### setFactoryBeanName
加载该类的`BeanFactory`的名称。

### setFactoryMethod
加载该类的`BeanFactory`中的工厂方法的名称。

### constructorArgumentValues 
该类的构造参数。

### propertyValues
新实例的属性值。

### initMethodName
初始化方法的名称。

### destroyMethodName
销毁方法的名称。